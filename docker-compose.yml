version: "3"
services:
  db:
    image: mysql
    environment:
      - MYSQL_PASSWORD=secret
      - MYSQL_ROOT_PASSWORD=root
    volumes:
      - ./db:/var/lib/mysql
    ports:
      - "3306:3306"
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    environment:
      PMA_ARBITRARY: 1
      MYSQL_PASSWORD: secret
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "8081:80"
  redis:
    image: redis
    hostname: redis
    container_name: redis
    expose:
      - "6379"
  redcom:
    image: tenstartups/redis-commander
    hostname: redcom
    container_name: redcom
    depends_on:
      - redis
    command: --redis-host redis
    ports:
      - "8082:8081"
  site:
    hostname: site
    image: registry.websplanetdemo.com/dev/site:latest
    volumes:
      - ./app:/usr/local/web/app/app
      - ./bin:/usr/local/web/app/bin
      - ./tests:/usr/local/web/app/tests
      - ./package.json:/usr/local/web/app/package.json
      - ./.sequelizerc:/usr/local/web/app/.sequelizerc
    ports:
      - "10000:10000"
    command: sh -c 'PORT=10000 NODE_ENV=development DEBUG=1 pm2-runtime start app/server.js --watch'
